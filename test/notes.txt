## TODO samples, lanes read groups

BaseRecalibrator --preserve_qscores_less_than 6 -dfrac .1 -nct 4  -R /home/sejjgot/devel/dnaseq-pipeline/data/reference/chr19.fasta  -I /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/bam-processed/sample-1.bam  -o /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/recal/sample-1_recal.txt -knownSites /SAN/CTO/reference/GRCh38/GATK-bundle/dbsnp_138.hg38.vcf.gz -knownSites /SAN/CTO/reference/GRCh38/GATK-bundle/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz -knownSites /SAN/CTO/reference/GRCh38/GATK-bundle/Homo_sapiens_assembly38.known_indels.vcf.gz

# -L sets the genomic intervals on which to operate
-L chr1 -L chr2 -L chr3 -L chr4 -L chr5 -L chr6 -L chr7 -L chr8 -L chr9 -L chr10 -L chr11 -L chr12 -L chr13 -L chr14 -L chr15 -L chr16 -L chr17 -L chr18 -L chr19 -L chr20 -L chr21 -L chr22

## warning
## Track knownSites doesn't have a sequence dictionary built in, skipping dictionary validation 

## see https://gatkforums.broadinstitute.org/gatk/discussion/6447/gzipped-gvcf-files


## dbSNP138, Mills and 1kg indels, and known indel

see
https://github.com/gatk-workflows/broad-prod-wgs-germline-snps-indels/blob/master/PairedEndSingleSampleWf.wdl

https://github.com/gatk-workflows/broad-prod-wgs-germline-snps-indels/blob/master/PairedEndSingleSampleWf.hg38.inputs.json


PrintReads --read_filter MappingQualityZero -preserveQ 6  -SQQ 10 -SQQ 20 -SQQ 30 --disable_indel_quals -R /home/sejjgot/devel/dnaseq-pipeline/data/reference/chr19.fasta -I /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/bam-processed/sample-1.bam -BQSR /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/recal/sample-1_recal.txt -o /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/recal/sample-1.bam


samtools view -T /home/sejjgot/devel/dnaseq-pipeline/data/reference/chr19.fasta -C -o /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/bam-calibrated/sample-1.cram /home/sejjgot/devel/dnaseq-pipeline/test/test-outdir/recal/sample-1.bam

gatk --java-options "-Xmx4g" HaplotypeCaller -R ../data/reference/chr19.fa -I  test-outdir/bam-calibrated/sample-1.cram -O test-outdir/vcf-raw/output.g.vcf.gz -ERC GVCF


gatk --java-options "-Xmx4g" HaplotypeCaller -R ../data/reference/chr19.fa -I  test-outdir/bam-calibrated/sample-1.cram -O test-outdir/vcf/output.g.vcf.gz

## for analysis see

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4619817/

 java -XX:-DoEscapeAnalysis -jar bin/GenomeAnalysisTK.jar -T HaplotypeCaller -R genome/hg19.fa -I alignments/NA12878.ALIGNER.BQSR.bam â€“dbsnp $DBSNP -o vcf_files/NA12878.ALIGNER.HC.raw.vcf -stand_call_conf 50


 In the cases of GATK HaplotypeCaller and GATK UnifiedGenotyper, the
 GATK modules, VariantRecalibrator and ApplyRecalibration, were used
 to filter SNVs using HapMap 3.3, the Omni 2.5 SNP BeadChip, and dbSNP
 137 without 1000 Genome data as training sets.

##

for benchmarking see GIAB website

http://jimb.stanford.edu/giab/

## Perform joint genotyping on one or more samples pre-called with HaplotypeCaller 

gatk GenotypeGVCFs -R  ../data/reference/chr19.fa -V test-outdir/vcf-raw/sample-1.vcf.gz -O test-outdir/vcf-genotyped/sample-1.vcf.gz

## TODO VariantRecalibrator


gatk VariantRecalibrator -R ../data/reference/chr19.fa -V  test-outdir/vcf-genotyped/sample-1.vcf.gz -O output.recal --resource hapmap,known=false,training=true,truth=true,prior=15.0:../data/reference/hapmap_3.3.hg38.vcf.gz --resource omni,known=false,training=true,truth=false,prior=12.0:../data/reference/1000G_omni2.5.hg38.vcf.gz --resource 1000G,known=false,training=true,truth=false,prior=10.0:../data/reference/1000G_phase1.snps.high_confidence.hg38.vcf.gz --resource dbsnp,known=true,training=false,truth=false,prior=2.0:../data/reference/dbsnp_138.hg38.vcf.gz -an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode SNP --tranches-file output.tranches --rscript-file output.plots.R



## 2018-08-14

## TODO

gatk GenomicsDBImport \
    -V data/gvcfs/mother.g.vcf \
    -V data/gvcfs/father.g.vcf \
    -V data/gvcfs/son.g.vcf \
    --genomicsdb-workspace-path my_database \
    --intervals chr20

gatk GenotypeGVCFs \
    -R data/ref/ref.fasta \
    -V gendb://my_database \
    -G StandardAnnotation -newQual \
    -O test_output.vcf



gatk --java-options "-Xmx4g" HaplotypeCaller -R ../data/reference/chr19.fa -I  test-outdir/bam-calibrated/sample-1.cram -O test-outdir/vcf-raw/output.g.vcf.gz -ERC GVCF

gatk GenotypeGVCFs -R  ../data/reference/chr19.fa -V test-outdir/vcf-raw/sample-1.vcf.gz -O test-outdir/vcf-genotyped/sample-1.vcf.gz

gatk VariantRecalibrator -R ../data/reference/chr19.fa -V  test-outdir/vcf-genotyped/sample-1.vcf.gz -O output.recal --resource hapmap,known=false,training=true,truth=true,prior=15.0:../data/reference/hapmap_3.3.hg38.vcf.gz --resource omni,known=false,training=true,truth=false,prior=12.0:../data/reference/1000G_omni2.5.hg38.vcf.gz --resource 1000G,known=false,training=true,truth=false,prior=10.0:../data/reference/1000G_phase1.snps.high_confidence.hg38.vcf.gz --resource dbsnp,known=true,training=false,truth=false,prior=2.0:../data/reference/dbsnp_138.hg38.vcf.gz -an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode SNP --tranches-file output.tranches --rscript-file output.plots.R



## 2018-09-21

gatk CombineGVCFs -R ../data/reference/chr19.fa --variant test-outdir/vcf-raw/sample-1.g.vcf.gz --variant test-outdir/vcf-raw/sample-2.g.vcf.gz -O test-outdir/vcf-combined/cohort.g.vcf.gz

gatk GenotypeGVCFs -R ../data/reference/chr19.fa -V test-outdir/vcf-combined/cohort.g.vcf.gz -O test-outdir/vcf-geno/cohort.g.vcf.gz

gatk VariantRecalibrator --verbosity=WARNING -R  ../data/reference/chr19.fa -V test-outdir/vcf-geno/cohort.g.vcf.gz -O test-outdir/vcf-calib/cohort.g.vcf.gz --resource hapmap,known=false,training=true,truth=true,prior=15.0:../data/reference/hapmap_3.3.hg38.vcf.gz --resource omni,known=false,training=true,truth=false,prior=12.0:../data/reference/1000G_omni2.5.hg38.vcf.gz --resource 1000G,known=false,training=true,truth=false,prior=10.0:../data/reference/1000G_phase1.snps.high_confidence.hg38.vcf.gz --resource dbsnp,known=true,training=false,truth=false,prior=2.0:../data/reference/dbsnp_138.hg38.vcf.gz -an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode SNP --tranches-file output.tranches --rscript-file output.plots.R

## This results in an error
## A USER ERROR has occurred: Bad input: Values for MQRankSum annotation not detected for ANY training variant in the input callset. VariantAnnotator may be used to add these annotations.

## maybe not enough samples?
